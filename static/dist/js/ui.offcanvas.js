"use strict";function Plugin(a,s){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=$(this),i=n.data("amui.offcanvas"),o=$.extend({},"object"==typeof a&&a);i||(n.data("amui.offcanvas",i=new OffCanvas(this,o)),(!a||"object"==typeof a)&&i.open(s)),"string"==typeof a&&i[a]&&i[a].apply(i,t)})}var $=require("jquery"),UI=require("./core");require("./util.hammer");var $win=$(window),$doc=$(document),scrollPos,OffCanvas=function(a,s){this.$element=$(a),this.options=$.extend({},OffCanvas.DEFAULTS,s),this.active=null,this.bindEvents()};OffCanvas.DEFAULTS={duration:300,effect:"overlay"},OffCanvas.prototype.open=function(a){var s=this,t=this.$element;if(t.length&&!t.hasClass("am-active")){var n=this.options.effect,i=$("html"),o=$("body"),e=t.find(".am-offcanvas-bar").first(),f=e.hasClass("am-offcanvas-bar-flip")?-1:1;e.addClass("am-offcanvas-bar-"+n),scrollPos={x:window.scrollX,y:window.scrollY},t.addClass("am-active"),o.css({width:window.innerWidth,height:$win.height()}).addClass("am-offcanvas-page"),"overlay"!==n&&o.css({"margin-left":e.outerWidth()*f}).width(),i.css("margin-top",scrollPos.y*-1),setTimeout(function(){e.addClass("am-offcanvas-bar-active").width()},0),t.trigger("open.offcanvas.amui"),this.active=1,t.on("click.offcanvas.amui",function(a){var t=$(a.target);t.hasClass("am-offcanvas-bar")||t.parents(".am-offcanvas-bar").first().length||(a.stopImmediatePropagation(),s.close())}),i.on("keydown.offcanvas.amui",function(a){27===a.keyCode&&s.close()})}},OffCanvas.prototype.close=function(a){function s(){i.removeClass("am-offcanvas-page").css({width:"",height:"","margin-left":"","margin-right":""}),o.removeClass("am-active"),e.removeClass("am-offcanvas-bar-active"),n.css("margin-top",""),window.scrollTo(scrollPos.x,scrollPos.y),o.trigger("closed.offcanvas.amui"),t.active=0}var t=this,n=$("html"),i=$("body"),o=this.$element,e=o.find(".am-offcanvas-bar").first();o.length&&this.active&&o.hasClass("am-active")&&(o.trigger("close.offcanvas.amui"),UI.support.transition?(setTimeout(function(){e.removeClass("am-offcanvas-bar-active")},0),i.css("margin-left","").one(UI.support.transition.end,function(){s()}).emulateTransitionEnd(this.options.duration)):s(),o.off("click.offcanvas.amui"),n.off(".offcanvas.amui"))},OffCanvas.prototype.bindEvents=function(){var a=this;return $doc.on("click.offcanvas.amui",'[data-am-dismiss="offcanvas"]',function(s){s.preventDefault(),a.close()}),$win.on("resize.offcanvas.amui orientationchange.offcanvas.amui",function(){a.active&&a.close()}),this.$element.hammer().on("swipeleft swipeleft",function(s){s.preventDefault(),a.close()}),this},$.fn.offCanvas=Plugin,$doc.on("click.offcanvas.amui","[data-am-offcanvas]",function(a){a.preventDefault();var s=$(this),t=UI.utils.parseOptions(s.data("amOffcanvas")),n=$(t.target||this.href&&this.href.replace(/.*(?=#[^\s]+$)/,"")),i=n.data("amui.offcanvas")?"open":t;Plugin.call(n,i,this)}),module.exports=UI.offcanvas=OffCanvas;