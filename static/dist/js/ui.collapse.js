"use strict";function Plugin(t){return this.each(function(){var e=$(this),a=e.data("amui.collapse"),s=$.extend({},Collapse.DEFAULTS,UI.utils.options(e.attr("data-am-collapse")),"object"==typeof t&&t);!a&&s.toggle&&"open"===t&&(t=!t),a||e.data("amui.collapse",a=new Collapse(this,s)),"string"==typeof t&&a[t]()})}var $=require("jquery"),UI=require("./core"),Collapse=function(t,e){this.$element=$(t),this.options=$.extend({},Collapse.DEFAULTS,e),this.transitioning=null,this.options.parent&&(this.$parent=$(this.options.parent)),this.options.toggle&&this.toggle()};Collapse.DEFAULTS={toggle:!0},Collapse.prototype.open=function(){if(!this.transitioning&&!this.$element.hasClass("am-in")){var t=$.Event("open.collapse.amui");if(this.$element.trigger(t),!t.isDefaultPrevented()){var e=this.$parent&&this.$parent.find("> .am-panel > .am-in");if(e&&e.length){var a=e.data("amui.collapse");if(a&&a.transitioning)return;Plugin.call(e,"close"),a||e.data("amui.collapse",null)}this.$element.removeClass("am-collapse").addClass("am-collapsing").height(0),this.transitioning=1;var s=function(){this.$element.removeClass("am-collapsing").addClass("am-collapse am-in").height("").trigger("opened.collapse.amui"),this.transitioning=0};if(!UI.support.transition)return s.call(this);var i=this.$element[0].scrollHeight;this.$element.one(UI.support.transition.end,$.proxy(s,this)).emulateTransitionEnd(300).css({height:i})}}},Collapse.prototype.close=function(){if(!this.transitioning&&this.$element.hasClass("am-in")){var t=$.Event("close.collapse.amui");if(this.$element.trigger(t),!t.isDefaultPrevented()){this.$element.height(this.$element.height()).redraw(),this.$element.addClass("am-collapsing").removeClass("am-collapse am-in"),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.trigger("closed.collapse.amui").removeClass("am-collapsing").addClass("am-collapse")};return UI.support.transition?void this.$element.height(0).one(UI.support.transition.end,$.proxy(e,this)).emulateTransitionEnd(300):e.call(this)}}},Collapse.prototype.toggle=function(){this[this.$element.hasClass("am-in")?"close":"open"]()},$.fn.collapse=Plugin,$(document).on("click.collapse.amui.data-api","[data-am-collapse]",function(t){var e,a=$(this),s=UI.utils.options(a.attr("data-am-collapse")),i=s.target||t.preventDefault()||(e=a.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,""),l=$(i),n=l.data("amui.collapse"),o=n?"toggle":s,r=s.parent,p=r&&$(r);n&&n.transitioning||(p&&p.find("[data-am-collapse]").not(a).addClass("am-collapsed"),a[l.hasClass("am-in")?"addClass":"removeClass"]("am-collapsed")),Plugin.call(l,o)}),module.exports=UI.collapse=Collapse;