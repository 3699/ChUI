"use strict";function Plugin(t){var a,e=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=$(this),n=i.is(".am-tabs")&&i||i.closest(".am-tabs"),s=n.data("amui.tabs"),o=$.extend({},UI.utils.parseOptions(i.data("amTabs")),$.isPlainObject(t)&&t);s||n.data("amui.tabs",s=new Tabs(n[0],o)),"string"==typeof t&&("open"===t&&i.is(".am-tabs-nav a")?s.open(i):a="function"==typeof s[t]?s[t].apply(s,e):s[t])}),void 0===a?this:a}var $=require("jquery"),UI=require("./core"),Hammer=require("./util.hammer"),supportTransition=UI.support.transition,animation=UI.support.animation,Tabs=function(t,a){this.$element=$(t),this.options=$.extend({},Tabs.DEFAULTS,a||{}),this.transitioning=this.activeIndex=null,this.refresh(),this.init()};Tabs.DEFAULTS={selector:{nav:"> .am-tabs-nav",content:"> .am-tabs-bd",panel:"> .am-tab-panel"},activeClass:"am-active"},Tabs.prototype.refresh=function(){var t=this.options.selector;this.$tabNav=this.$element.find(t.nav),this.$navs=this.$tabNav.find("a"),this.$content=this.$element.find(t.content),this.$tabPanels=this.$content.find(t.panel);var a=this.$tabNav.find("> ."+this.options.activeClass);1!==a.length?this.open(0):this.activeIndex=this.$navs.index(a.children("a"))},Tabs.prototype.init=function(){var t=this,a=this.options;if(this.$element.on("click.tabs.amui",a.selector.nav+" a",function(a){a.preventDefault(),t.open($(this))}),!a.noSwipe){if(!this.$content.length)return this;var e=new Hammer.Manager(this.$content[0]),i=new Hammer.Swipe({direction:Hammer.DIRECTION_HORIZONTAL});e.add(i),e.on("swipeleft",UI.utils.debounce(function(a){a.preventDefault(),t.goTo("next")},100)),e.on("swiperight",UI.utils.debounce(function(a){a.preventDefault(),t.goTo("prev")},100)),this._hammer=e}},Tabs.prototype.open=function(t){var a=this.options.activeClass,e="number"==typeof t?t:this.$navs.index($(t));if(t="number"==typeof t?this.$navs.eq(e):$(t),t&&t.length&&!this.transitioning&&!t.parent("li").hasClass(a)){var i=this.$tabNav,n=t.attr("href"),s=/^#.+$/,o=s.test(n)&&this.$content.find(n)||this.$tabPanels.eq(e),r=i.find("."+a+" a")[0],h=$.Event("open.tabs.amui",{relatedTarget:r});t.trigger(h),h.isDefaultPrevented()||(this.activate(t.closest("li"),i),this.activate(o,this.$content,function(){t.trigger({type:"opened.tabs.amui",relatedTarget:r})}),this.activeIndex=e)}},Tabs.prototype.activate=function(t,a,e){this.transitioning=!0;var i=this.options.activeClass,n=a.find("> ."+i),s=e&&supportTransition&&!!n.length;n.removeClass(i+" am-in"),t.addClass(i),s?(t.redraw(),t.addClass("am-in")):t.removeClass("am-fade");var o=$.proxy(function(){e&&e(),this.transitioning=!1},this);s&&!this.$content.is(".am-tabs-bd-ofv")?n.one(supportTransition.end,o):o()},Tabs.prototype.goTo=function(t){var a=this.activeIndex,e="next"===t,i=e?"am-animation-right-spring":"am-animation-left-spring";if(e&&a+1>=this.$navs.length||!e&&0===a){var n=this.$tabPanels.eq(a);animation&&n.addClass(i).on(animation.end,function(){n.removeClass(i)})}else this.open(e?a+1:a-1)},Tabs.prototype.destroy=function(){this.$element.off(".tabs.amui"),Hammer.off(this.$content[0],"swipeleft swiperight"),this._hammer&&this._hammer.destroy(),$.removeData(this.$element,"amui.tabs")},$.fn.tabs=Plugin,UI.ready(function(t){$("[data-am-tabs]",t).tabs()}),$(document).on("click.tabs.amui.data-api","[data-am-tabs] .am-tabs-nav a",function(t){t.preventDefault(),Plugin.call($(this),"open")}),module.exports=UI.tabs=Tabs;