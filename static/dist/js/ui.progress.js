"use strict";var UI=require("./core"),Progress=function(){function e(e,n,r){return e<n?n:e>r?r:e}function n(e){return 100*(-1+e)}function r(e,r,t){var s;return s="translate3d"===c.positionUsing?{transform:"translate3d("+n(e)+"%,0,0)"}:"translate"===c.positionUsing?{transform:"translate("+n(e)+"%,0)"}:{"margin-left":n(e)+"%"},s.transition="all "+r+"ms "+t,s}function t(e,n){var r="string"==typeof e?e:o(e);return r.indexOf(" "+n+" ")>=0}function s(e,n){var r=o(e),s=r+n;t(r,n)||(e.className=s.substring(1))}function i(e,n){var r,s=o(e);t(e,n)&&(r=s.replace(" "+n+" "," "),e.className=r.substring(1,r.length-1))}function o(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function a(e){e&&e.parentNode&&e.parentNode.removeChild(e)}var u={};u.version="0.2.0";var c=u.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,parent:"body",barSelector:'[role="nprogress-bar"]',spinnerSelector:'[role="nprogress-spinner"]',template:'<div class="nprogress-bar" role="nprogress-bar"><div class="nprogress-peg"></div></div><div class="nprogress-spinner" role="nprogress-spinner"><div class="nprogress-spinner-icon"></div></div>'};u.configure=function(e){var n,r;for(n in e)r=e[n],void 0!==r&&e.hasOwnProperty(n)&&(c[n]=r);return this},u.status=null,u.set=function(n){var t=u.isStarted();n=e(n,c.minimum,1),u.status=1===n?null:n;var s=u.render(!t),i=s.querySelector(c.barSelector),o=c.speed,a=c.easing;return s.offsetWidth,l(function(e){""===c.positionUsing&&(c.positionUsing=u.getPositioningCSS()),p(i,r(n,o,a)),1===n?(p(s,{transition:"none",opacity:1}),s.offsetWidth,setTimeout(function(){p(s,{transition:"all "+o+"ms linear",opacity:0}),setTimeout(function(){u.remove(),e()},o)},o)):setTimeout(e,o)}),this},u.isStarted=function(){return"number"==typeof u.status},u.start=function(){u.status||u.set(0);var e=function(){setTimeout(function(){u.status&&(u.trickle(),e())},c.trickleSpeed)};return c.trickle&&e(),this},u.done=function(e){return e||u.status?u.inc(.3+.5*Math.random()).set(1):this},u.inc=function(n){var r=u.status;return r?("number"!=typeof n&&(n=(1-r)*e(Math.random()*r,.1,.95)),r=e(r+n,0,.994),u.set(r)):u.start()},u.trickle=function(){return u.inc(Math.random()*c.trickleRate)},function(){var e=0,n=0;u.promise=function(r){return r&&"resolved"!==r.state()?(0===n&&u.start(),e++,n++,r.always(function(){n--,0===n?(e=0,u.done()):u.set((e-n)/e)}),this):this}}(),u.render=function(e){if(u.isRendered())return document.getElementById("nprogress");s(document.documentElement,"nprogress-busy");var r=document.createElement("div");r.id="nprogress",r.innerHTML=c.template;var t,i=r.querySelector(c.barSelector),o=e?"-100":n(u.status||0),l=document.querySelector(c.parent);return p(i,{transition:"all 0 linear",transform:"translate3d("+o+"%,0,0)"}),c.showSpinner||(t=r.querySelector(c.spinnerSelector),t&&a(t)),l!=document.body&&s(l,"nprogress-custom-parent"),l.appendChild(r),r},u.remove=function(){i(document.documentElement,"nprogress-busy"),i(document.querySelector(c.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&a(e)},u.isRendered=function(){return!!document.getElementById("nprogress")},u.getPositioningCSS=function(){var e=document.body.style,n="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return n+"Perspective"in e?"translate3d":n+"Transform"in e?"translate":"margin"};var l=function(){function e(){var r=n.shift();r&&r(e)}var n=[];return function(r){n.push(r),1==n.length&&e()}}(),p=function(){function e(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(e,n){return n.toUpperCase()})}function n(e){var n=document.body.style;if(e in n)return e;for(var r,t=s.length,i=e.charAt(0).toUpperCase()+e.slice(1);t--;)if(r=s[t]+i,r in n)return r;return e}function r(r){return r=e(r),i[r]||(i[r]=n(r))}function t(e,n,t){n=r(n),e.style[n]=t}var s=["Webkit","O","Moz","ms"],i={};return function(e,n){var r,s,i=arguments;if(2==i.length)for(r in n)s=n[r],void 0!==s&&n.hasOwnProperty(r)&&t(e,r,s);else t(e,i[1],i[2])}}();return u}();module.exports=UI.progress=Progress;