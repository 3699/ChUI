"use strict";var $=require("jquery"),UI=require("./core"),animation=UI.support.animation,Dropdown=function(o,t){this.options=$.extend({},Dropdown.DEFAULTS,t),t=this.options,this.$element=$(o),this.$toggle=this.$element.find(t.selector.toggle),this.$dropdown=this.$element.find(t.selector.dropdown),this.$boundary=t.boundary===window?$(window):this.$element.closest(t.boundary),this.$justify=t.justify&&$(t.justify).length&&$(t.justify)||void 0,!this.$boundary.length&&(this.$boundary=$(window)),this.active=!!this.$element.hasClass("am-active"),this.animating=null,this.events()};Dropdown.DEFAULTS={animation:"am-animation-slide-top-fixed",boundary:window,justify:void 0,selector:{dropdown:".am-dropdown-content",toggle:".am-dropdown-toggle"},trigger:"click"},Dropdown.prototype.toggle=function(){this.clear(),this.animating||this[this.active?"close":"open"]()},Dropdown.prototype.open=function(o){var t=this.$toggle,i=this.$element,n=this.$dropdown;if(!t.is(".am-disabled, :disabled")&&!this.active){i.trigger("open.dropdown.amui").addClass("am-active"),t.trigger("focus"),this.checkDimensions(o);var e=$.proxy(function(){i.trigger("opened.dropdown.amui"),this.active=!0,this.animating=0},this);animation?(this.animating=1,n.addClass(this.options.animation).on(animation.end+".open.dropdown.amui",$.proxy(function(){e(),n.removeClass(this.options.animation)},this))):e()}},Dropdown.prototype.close=function(){if(this.active){var o="am-dropdown-animation",t=this.$element,i=this.$dropdown;t.trigger("close.dropdown.amui");var n=$.proxy(function(){t.removeClass("am-active").trigger("closed.dropdown.amui"),this.active=!1,this.animating=0,this.$toggle.blur()},this);animation?(i.removeClass(this.options.animation),i.addClass(o),this.animating=1,i.one(animation.end+".close.dropdown.amui",function(){i.removeClass(o),n()})):n()}},Dropdown.prototype.enable=function(){this.$toggle.prop("disabled",!1)},Dropdown.prototype.disable=function(){this.$toggle.prop("disabled",!0)},Dropdown.prototype.checkDimensions=function(o){if(this.$dropdown.length){var t=this.$dropdown;o&&o.offset&&t.offset(o.offset);var i=t.offset(),n=t.outerWidth(),e=this.$boundary.width(),s=$.isWindow(this.boundary)&&this.$boundary.offset()?this.$boundary.offset().left:0;this.$justify&&t.css({"min-width":this.$justify.css("width")}),n+(i.left-s)>e&&this.$element.addClass("am-dropdown-flip")}},Dropdown.prototype.clear=function(){$("[data-am-dropdown]").not(this.$element).each(function(){var o=$(this).data("amui.dropdown");o&&o.close()})},Dropdown.prototype.events=function(){var o="dropdown.amui",t=this.$toggle;t.on("click."+o,$.proxy(function(o){o.preventDefault(),this.toggle()},this)),$(document).on("keydown.dropdown.amui",$.proxy(function(o){27===o.keyCode&&this.active&&this.close()},this)).on("click.outer.dropdown.amui",$.proxy(function(o){!this.active||this.$element[0]!==o.target&&this.$element.find(o.target).length||this.close()},this))},UI.plugin("dropdown",Dropdown),UI.ready(function(o){$("[data-am-dropdown]",o).dropdown()}),$(document).on("click.dropdown.amui.data-api",".am-dropdown form",function(o){o.stopPropagation()}),module.exports=UI.dropdown=Dropdown;