"use strict";var $=require("jquery"),UI=require("./core"),Button=function(t,a){this.$element=$(t),this.options=$.extend({},Button.DEFAULTS,a),this.isLoading=!1,this.hasSpinner=!1};Button.DEFAULTS={loadingText:"loading...",disabledClassName:"am-disabled",activeClassName:"am-active",spinner:void 0},Button.prototype.setState=function(t,a){var e=this.$element,n="disabled",s=e.data(),i=this.options,o=e.is("input")?"val":"html",l="am-btn-"+t+" "+i.disabledClassName;t+="Text",i.resetText||(i.resetText=e[o]()),UI.support.animation&&i.spinner&&"html"===o&&!this.hasSpinner&&(i.loadingText='<span class="am-icon-'+i.spinner+' am-icon-spin"></span>'+i.loadingText,this.hasSpinner=!0),a=a||(void 0===s[t]?i[t]:s[t]),e[o](a),setTimeout($.proxy(function(){"loadingText"===t?(e.addClass(l).attr(n,n),this.isLoading=!0):this.isLoading&&(e.removeClass(l).removeAttr(n),this.isLoading=!1)},this),0)},Button.prototype.toggle=function(){var t=!0,a=this.$element,e=this.$element.parent('[class*="am-btn-group"]'),n=Button.DEFAULTS.activeClassName;if(e.length){var s=this.$element.find("input");"radio"==s.prop("type")&&(s.prop("checked")&&a.hasClass(n)?t=!1:e.find("."+n).removeClass(n)),t&&s.prop("checked",!a.hasClass(n)).trigger("change")}t&&(a.toggleClass(n),a.hasClass(n)||a.blur())},UI.plugin("button",Button,{dataOptions:"data-am-loading",methodCall:function(t,a){"toggle"===t[0]?a.toggle():"string"==typeof t[0]&&a.setState.apply(a,t)}}),$(document).on("click.button.amui.data-api","[data-am-button]",function(t){t.preventDefault();var a=$(t.target);a.hasClass("am-btn")||(a=a.closest(".am-btn")),a.button("toggle")}),UI.ready(function(t){$("[data-am-loading]",t).button(),$("[data-am-button]",t).find("input:checked").each(function(){$(this).parent("label").addClass(Button.DEFAULTS.activeClassName)})}),module.exports=UI.button=Button;